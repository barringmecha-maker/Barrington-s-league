function updateLeagueTable() {
  const ss = SpreadsheetApp.getActiveSpreadsheet();
  const resultsSheet = ss.getSheetByName("Results");
  const tableSheet = ss.getSheetByName("League Table");

  const results = resultsSheet.getDataRange().getValues().slice(1); // Skip header
  const teams = {};

  results.forEach(row => {
    const [date, home, homeGoals, away, awayGoals] = row;
    if (!home || !away || homeGoals === "" || awayGoals === "") return;

    const hGoals = parseInt(homeGoals, 10);
    const aGoals = parseInt(awayGoals, 10);

    if (!teams[home]) teams[home] = { P: 0, W: 0, D: 0, L: 0, GF: 0, GA: 0 };
    if (!teams[away]) teams[away] = { P: 0, W: 0, D: 0, L: 0, GF: 0, GA: 0 };

    teams[home].P++; teams[away].P++;
    teams[home].GF += hGoals; teams[home].GA += aGoals;
    teams[away].GF += aGoals; teams[away].GA += hGoals;

    if (hGoals > aGoals) {
      teams[home].W++; teams[away].L++;
    } else if (hGoals < aGoals) {
      teams[away].W++; teams[home].L++;
    } else {
      teams[home].D++; teams[away].D++;
    }
  });

  const table = Object.entries(teams).map(([team, stats]) => {
    const GD = stats.GF - stats.GA;
    const Pts = stats.W * 3 + stats.D;
    return [team, stats.P, stats.W, stats.D, stats.L, stats.GF, stats.GA, GD, Pts];
  });

  table.sort((a, b) => b[8] - a[8] || b[7] - a[7]); // Sort by Points, then GD

  tableSheet.clearContents();
  tableSheet.appendRow(["Team", "Played", "Won", "Drawn", "Lost", "GF", "GA", "GD", "Points"]);
  table.forEach(row => tableSheet.appendRow(row));
}